var fs = require("fs");
const parse = require("./parser.js");

// this html:
//var html = "<html><head><title>Hello</title></head><body><h1 class='Gorilla' type='monkey'>Hello my friend</h1><img src='dolphing.jpg'/></body></html>";
const html = fs.readFileSync("./index.html", "utf8");
// becomes this AST:
//
var ast = parse(html);

function format(element, level) {
  let content = "";
  let tabs = tab(level);

  if (element.type === "text") return tabs + element.content;

  if (element.type === "tag") {
    content += `${tabs}<${element.name}`;

    if (Object.keys(element.attrs).length !== 0)
      content += " " +
        Object.keys(element.attrs)
          .map((key, value) => `${key}="${element.attrs[key]}"`)
          .join(" ");

    if (element.voidElement !== true) content += ">\n";
  }

  if (element.children)
    content += element.children.map(e => format(e, level + 1)).join("\n");

  if (element.voidElement) return content + "/>";

  if (element.type === "tag") content += `\n${tabs}</${element.name}>`;
  return content;
}

function tab(level) {
  if (level > 0) return "  " + tab(level - 1);

  return "";
}

console.log(JSON.stringify(ast));

//console.log(ast.map(e => format(e, 0)).join("\n"));
